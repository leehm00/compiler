# Lab4 实验报告

小组成员  

| 姓名   | 学号       |
| ------ | ---------- |
| 李泓民 | PB18071495 |
| 单航   | PB18111747 |

## 实验要求

请按照自己的理解，写明本次实验需要干什么

主要是补充cminusf_builder.cpp中的各个函数,添加自己定义的全局变量,在这个文件里面通过访问者模式实现IR自动生成的算法.

每一个函数基本上都对应了一个语句块实现,比如iteration就是while循环一样.

## 实验难点

实验中遇到哪些挑战

最开始由于看不太懂文档没有思路,根本不知道怎么下手,连一个函数都写不出来,后面才发现IRbuilder这些文件也是必须读的,很多函数就是在其他文件中早就定义好的,直接用就行了.

还有的问题就是我们对于C++也不是特别熟悉,包括shared-ptr这些,builder的各个属性,都不知道怎么调用,对于class的使用方法也不是很熟悉,去查了很久资料才开始会使用类的各个属性.

包括对于AST的各个节点是干什么的也不是很清楚,也只有仔细读了ast.cpp文件才知道accept函数的用法.

以及对于scope的作用也不是特别清楚,虽然readme里面说了是这样的:

> 在`include/cminusf_builder.hpp`中，我还定义了一个用于存储作用域的类`Scope`。它的作用是辅助我们在遍历语法树时，管理不同作用域中的变量。

但是实际用起来的时候根本不知道那些时候该添加scope.enter(),scope.exit()，只是知道有的地方应该判断全局变量，应该用find（）寻找变量值。

主要的难点在于有几个函数比较难写,`ASTVarDeclaration，ASTFunDeclaration，ASTSelectionStmt，ASTIterationStmt，ASTVar`这几个函数，可能是后面的是因为前面的写的有经验了所以就觉得会简单一些了...



## 实验设计

请写明为了顺利完成本次实验，加入了哪些亮点设计，并对这些设计进行解释。
可能的阐述方向有:

- 如何设计全局变量
- 遇到的难点以及解决方案
- 如何降低生成 IR 中的冗余
- 比较难的函数解释
  - `ASTVarDeclaration`就是比较繁杂，分情况比较多，需要先分成全局变量和局部变量，全局变量的情况用scope.in_global（）来判断是否是全局变量，通过AST的shared_ptr，基本上记录了node的基本信息直接用就行，再分成int，float，array中的int和float集中情况分别记录，scope.push（）之前不知道用在哪，这里用来记录array的元素的。
  - 


### 实验总结

此次实验有什么收获

### 实验反馈 （可选 不会评分）

对本次实验的建议

希望可以多给一些参考文件,其实要看的引用的文件根本就不只有ast.cpp.还有common中的文件基本上都用得到,C++使用并不熟悉困扰很大,不会的就必须得去查资料.

### 组间交流 （可选）

本次实验和哪些组（记录组长学号）交流了哪一部分信息
